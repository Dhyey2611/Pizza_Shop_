@using Pizza_Shop_.ViewModels
@model PaginatedCustomerListViewModel

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
<link rel="stylesheet" href="~/css/Customers/Customer.css" />
<script src="~/js/Customer/Customer.js"></script>
<div class="customers-container">
    <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
        <h2 class="customers-title">Customers</h2>

        @* <div class="d-flex align-items-center gap-2">
            <div class="search-bar position-relative">
                <input type="text" name="searchTerm" class="form-control" placeholder="Search" />
                <i class="fa fa-search search-icon"></i>
            </div>

            <select class="form-select" style="width: 160px;">
                <option>All Time</option>
            </select>

            <button type="button" class="btn btn-export d-flex align-items-center gap-1">
                <i class="fa fa-file-export"></i> Export
            </button>
        </div> *@
        @* <div class="d-flex align-items-center gap-2">
            <form method="get" asp-controller="SuperAdmin" asp-action="Customers" class="m-0">
                <div class="search-bar position-relative">
                    <input type="text" name="searchTerm" class="form-control" placeholder="Search" value="@Context.Request.Query["searchTerm"]" />
                    <i class="fa fa-search search-icon"></i>
                </div>
                <select class="form-select" style="width: 160px;">
                    <option>All Time</option>
                </select>
            </form>
                <button type="button" onclick="exportCustomerData()" class="btn btn-export d-flex align-items-center gap-1">
                    <i class="fa fa-file-export"></i> Export
                </button>
        </div> *@
        <div class="d-flex align-items-center gap-2">
            <form method="get" asp-controller="SuperAdmin" asp-action="Customers" class="d-flex align-items-center gap-2 m-0">
                <div class="search-bar position-relative">
                    <input type="text" name="searchTerm" class="form-control" placeholder="Search" value="@Context.Request.Query["searchTerm"]" />
                    <i class="fa fa-search search-icon"></i>
                </div>
                <select class="form-select" style="width: 160px;">
                    <option>All Time</option>
                </select>
            </form>
            <!-- Export button stays outside form but still in same line -->
            <button type="button" onclick="exportCustomerData()" class="btn btn-export d-flex align-items-center gap-1">
                <i class="fa fa-file-export"></i> Export
            </button>
        </div>
    </div>

    <table class="table customers-table">
        <thead>
            <tr>
                @* <th>Name <i class="fa fa-sort ms-1"></i></th> *@
                <th>
                    <a href="?sortBy=name&sortOrder=@(Context.Request.Query["sortOrder"] == "asc" ? "desc" : "asc")">
                        Name <i class="fa fa-sort ms-1"></i>
                    </a>
                </th>
                <th>Email</th>
                <th>Phone Number</th>
                @* <th>Date <i class="fa fa-sort ms-1"></i></th> *@
                <th>
                    <a href="?sortBy=createdDate&sortOrder=@(Context.Request.Query["sortOrder"] == "asc" ? "desc" : "asc")">
                        Date <i class="fa fa-sort ms-1"></i>
                    </a>
                </th>
                @* <th>Total Order <i class="fa fa-sort ms-1"></i></th> *@
                <th>
                    <a href="?sortBy=totalOrders&sortOrder=@(Context.Request.Query["sortOrder"] == "asc" ? "desc" : "asc")">
                        Total Order <i class="fa fa-sort ms-1"></i>
                    </a>
            </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var c in Model.Customers)
            {
                <tr>
                    <td>@c.Name</td>
                    <td>@c.Email</td>
                    <td>@c.PhoneNumber</td>
                    <td>@c.CreatedDate.ToString("dd-MM-yyyy")</td>
                    <td>@c.TotalOrders</td>
                </tr>
            }
        </tbody>
    </table>

    <div class="pagination-row d-flex justify-content-end align-items-center mt-3 gap-2">
        <label class="mb-0">Items Per page:</label>
        <select class="form-select w-auto">
            <option>5</option>
            <option>10</option>
            <option>25</option>
        </select>
        <span>Showing @((Model.CurrentPage - 1) * 5 + 1) â€“ @(Math.Min(Model.CurrentPage * 5, Model.TotalItems)) of @Model.TotalItems</span>
        @if (Model.CurrentPage > 1)
        {
            <a asp-action="Customers" asp-route-page="@(Model.CurrentPage - 1)" class="btn btn-light"><i class="fa fa-chevron-left"></i></a>
        }
        @if ((Model.CurrentPage * 5) < Model.TotalItems)
        {
            <a asp-action="Customers" asp-route-page="@(Model.CurrentPage + 1)" class="btn btn-light"><i class="fa fa-chevron-right"></i></a>
        }
    </div>
</div>
